<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waste Classifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4" x-data="app()">
        <h1 class="text-3xl font-bold text-center my-6">Waste Classification</h1>
        
        <!-- Upload Section -->
        <div class="bg-white p-6 rounded-lg shadow-md mb-6">
            <input type="file" @change="handleFileUpload" class="hidden" id="fileInput" accept="image/*">
            <label for="fileInput" class="cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600">
                Upload Image
            </label>
            <div x-show="imageUrl" class="mt-4">
                <img :src="imageUrl" alt="Uploaded Image" class="max-w-full h-64 mx-auto rounded-lg">
            </div>
        </div>

        <!-- Results Section -->
        <div x-show="results" class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">Results</h2>
            
            <!-- Model 1 Results -->
            <div class="mb-6">
                <h3 class="text-lg font-medium">Model 1 (Basic)</h3>
                <p>Prediction: <span class="font-bold" x-text="results.model1.prediction"></span></p>
                <p>Confidence: <span x-text="results.model1.confidence + '%'"></span></p>
                
                <!-- Confidence Bars -->
                <div class="mt-2 space-y-2">
                    <template x-for="(prob, cls) in results.model1.all_probs" :key="cls">
                        <div>
                            <span x-text="cls" class="w-24 inline-block"></span>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="bg-blue-500 h-4 rounded-full" :style="'width: ' + prob + '%'"></div>
                            </div>
                            <span x-text="prob + '%'" class="ml-2"></span>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Model 2 Results -->
            <div>
                <h3 class="text-lg font-medium">Model 2 (Enhanced)</h3>
                <p>Prediction: <span class="font-bold" x-text="results.model2.prediction"></span></p>
                <p>Confidence: <span x-text="results.model2.confidence + '%'"></span></p>
                
                <!-- Confidence Bars -->
                <div class="mt-2 space-y-2">
                    <template x-for="(prob, cls) in results.model2.all_probs" :key="cls">
                        <div>
                            <span x-text="cls" class="w-24 inline-block"></span>
                            <div class="w-full bg-gray-200 rounded-full h-4">
                                <div class="bg-green-500 h-4 rounded-full" :style="'width: ' + prob + '%'"></div>
                            </div>
                            <span x-text="prob + '%'" class="ml-2"></span>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('app', () => ({
                imageUrl: null,
                results: null,
                isLoading: false,

                handleFileUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;

                    this.isLoading = true;
                    const formData = new FormData();
                    formData.append('file', file);

                    fetch('/predict', {
                        method: 'POST',
                        body: formData
                    })
                    .then(res => res.json())
                    .then(data => {
                        this.imageUrl = data.image_url;
                        this.results = data;
                    })
                    .catch(err => console.error(err))
                    .finally(() => this.isLoading = false);
                }
            }))
        })
    </script>
</body>
</html>